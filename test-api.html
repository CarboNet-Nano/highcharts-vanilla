<!DOCTYPE html>
<html>
  <head>
    <title>Chart API Test</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #chart-container {
        width: 100%;
        height: 70vh;
        min-height: 300px;
      }
      #controls {
        padding: 20px;
        text-align: center;
      }
      #status {
        margin-top: 10px;
        padding: 5px;
        min-height: 20px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .updating {
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="chart-container"></div>
    <div id="controls">
      <div>
        <input type="text" id="value1" value="35" />
        <input type="text" id="value2" value="46" />
        <input type="text" id="value3" value="82" />
        <button onclick="updateValues()">Update Values</button>
      </div>
      <div id="status"></div>
    </div>

    <script type="module">
      import { Chart } from "./chart.js";
      import { EventManager } from "./eventManager.js";

      let chartInstance;
      const API_URL = "/.netlify/functions/update-chart-data";
      const statusDiv = document.getElementById("status");

      function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = type;
      }

      async function callAPI(values) {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ values }),
        });

        if (!response.ok) {
          throw new Error(`API Error: ${response.statusText}`);
        }

        return response.json();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("chart-container");
        chartInstance = new Chart(container);
        const events = new EventManager(chartInstance);

        window.updateValues = async () => {
          try {
            showStatus("Updating...", "updating");

            // Get values from inputs
            const values = [
              parseFloat(document.getElementById("value1").value),
              parseFloat(document.getElementById("value2").value),
              parseFloat(document.getElementById("value3").value),
            ];

            // Call API
            const data = await callAPI(values);

            if (data.success) {
              // Update chart with validated values from API
              chartInstance.updateChartValues(data.values);
              showStatus("Update successful", "success");
            } else {
              throw new Error("API update failed");
            }
          } catch (error) {
            console.error("Update failed:", error);
            showStatus(`Error: ${error.message}`, "error");
          }
        };
      });
    </script>
  </body>
</html>
